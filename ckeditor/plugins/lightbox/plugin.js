(function(){CKEDITOR.plugins.add("lightbox",{lang:[CKEDITOR.lang.detect(CKEDITOR.config.language)]});CKEDITOR.on("dialogDefinition",function(a){var b=a.data.name;var c=a.data.definition;var d=a.editor;if(b=="image"){function e(a){try{var b=a.getSelection();if(b.getType()==CKEDITOR.SELECTION_ELEMENT){var c=b.getSelectedElement();if(c.is("a"))return c}var d=b.getRanges(true)[0];d.shrink(CKEDITOR.SHRINK_TEXT);var e=d.getCommonAncestor();return e.getAscendant("a",true)}catch(f){return null}}function f(){var a=CKEDITOR.dialog.getCurrent();var b=a.getContentElement("info","BoxZoom");NextField=a.getContentElement("info","BoxNext"),NumField=a.getContentElement("info","BoxNum"),RelField=a.getContentElement("info","BoxRel");var c="";if(b.getValue()==true){c="lightbox";if(NextField.getValue()==true&&NumField.getValue()!=""){c=c+NumField.getValue()}RelField.setValue(c)}else{RelField.setValue("")}}var g=c.getContents("info");g.add({type:"vbox",padding:0,children:[{type:"html",html:d.lang.lightbox.title},{type:"hbox",style:"margin:0px;width:100px;vertical-align: middle;",children:[{type:"html",html:d.lang.lightbox.imgzoom,style:"display:block;margin-top:3px;"},{type:"checkbox",id:"BoxZoom",label:" ","default":"",style:"margin-right:5px;padding:0px",onChange:function(){var a=CKEDITOR.dialog.getCurrent();var b=a.getContentElement("info","txtUrl"),c=a.getContentElement("info","BoxNext"),d=a.getContentElement("info","BoxNum"),e=a.getContentElement("Link","txtUrl"),g=b.getValue(),h;if(g!=""){var i=g.substr(g.lastIndexOf("/")+1);var j=g.substring(0,g.lastIndexOf("/"));h=j+"/"+i.replace(".tb.",".")}if(b.getValue()=="")this.setValue(false,"change");if(this.getValue()==false){if(c.getValue()==true)c.setValue(false,"change");d.setValue("");e.setValue("")}else{e.setValue(h)}f()},onShow:function(){var a=CKEDITOR.dialog.getCurrent();var b=a.getContentElement("info","txtUrl"),c=a.getContentElement("Link","txtUrl"),d=b.getValue();orgLinkField=c.getValue();if(d!=""){var e=d.substr(d.lastIndexOf("/")+1);var f=d.substring(0,d.lastIndexOf("/"));boxLnkUrl=f+"/"+e.replace(".tb.",".")}if(orgLinkField==boxLnkUrl){this.setValue(true,"change")}else{this.setValue(false,"change")}}},{type:"html",html:d.lang.lightbox.browse,style:"display:block;margin-top:3px;"},{type:"checkbox",id:"BoxNext",label:" ","default":"",style:"margin-right:5px;padding:0px",onClick:function(){var a=CKEDITOR.dialog.getCurrent();var b=a.getContentElement("info","BoxZoom");var c=a.getContentElement("info","BoxNum");if(b.getValue()==false&&this.getValue()==true)this.setValue(false,"change");if(this.getValue()==false)c.setValue("");else c.setValue("1");f()}},{type:"html",html:d.lang.lightbox.boxnum+":",style:"display:block;margin-top:3px;"},{type:"text",id:"BoxNum",label:" ","default":"",style:"width:25px",validate:CKEDITOR.dialog.validate.integer(d.lang.lightbox.mustint),onKeyUp:function(){var a=CKEDITOR.dialog.getCurrent();var b=a.getContentElement("info","BoxZoom");var c=a.getContentElement("info","BoxNext");if(b.getValue()==false||c.getValue()==false)this.setValue("");if(b.getValue()!=false&&c.getValue()!=false&&this.getValue()<=0)this.setValue("1");f()}},{type:"text",id:"BoxRel",label:"","default":"",style:"display: none",onHide:function(){this.setValue("")},setup:function(){var a=e(d);if(a){this.setValue(a.getAttribute("rel")||"");var b=CKEDITOR.dialog.getCurrent();var c=b.getContentElement("Link","txtUrl"),f=c.getValue(),g=b.getContentElement("info","BoxZoom"),h=b.getContentElement("info","BoxNext"),i=b.getContentElement("info","BoxNum");if(f!=""&&this.getValue()!=""){var j=this.getValue();relLight=j.substring(0,8);if(relLight=="lightbox"){g.setValue(true,"change");relNr=j.substr(8);if(relNr!=""){h.setValue(true,"change");i.setValue(relNr)}}}}},commit:function(){if(this.getValue()!=""){this.linkElement=this.getDialog().linkElement;this.linkElement.setAttribute("rel",this.getValue())}}}]}]},"txtAlt")}})})()